# 软件测试用例 (Test Cases)

## 1. 引言
### 1.1 目的
本文档描述了验证“世界遗产数据系统”功能的测试用例，覆盖数据采集、展示和智能分析三个子系统。

### 1.2 范围
功能测试 (Functional Testing)、数据验证 (Data Verification)、AI 效果测试 (AI Evaluation)。

## 2. 测试环境
- **OS**: Linux
- **Database**: PostgreSQL 15, Chroma (Dockerized)
- **Dependencies**: Python 3.10+, Scrapy, Django, Local LLM service

## 3. 测试用例列表

### 3.1 数据采集模块 (Crawler)

| 用例ID | 测试项 | 前置条件 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-001** | 全量抓取测试 | 数据库为空，目标站点可访问 | 1. 运行 `scrapy crawl heritage_spider`。<br>2. 等待爬虫完成。 | 1. 爬虫正常结束 code 0。<br>2. 数据库 `heritage_site` 表中有数据。<br>3. 数据量与官网大致相符。 |
| **TC-002** | 增量更新测试 | 数据库已有数据 | 1. 修改一条数据的本地状态。<br>2. 再次运行爬虫。 | 1. 爬虫识别到已有数据。<br>2. 仅更新变化字段或跳过未变数据。<br>3. 不会产生主键冲突错误。 |
| **TC-003** | 字段清洗验证 | - | 1. 检查数据库中 `description_en`/`content` 字段。 | 1. 无 HTML 标签 (如 `<p>`, `<div>`)。<br>2. 无连续的多余空格。 |

### 3.2 Web 展示模块 (Display)

| 用例ID | 测试项 | 前置条件 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-004** | 列表页筛选 | 数据库有“中国”和“法国”的数据 | 1. 访问列表页。<br>2. 筛选 Country="China"。 | 1. 列表只显示中国的遗产。<br>2. 结果数量正确。 |
| **TC-005** | 详情页展示 | - | 1. 点击任意列表项进入详情页。 | 1. 页面加载成功。<br>2. 名称、描述（中英）、详细内容、地图坐标均正确显示。 |
| **TC-006** | 接口响应速度 | 模拟 50 并发 | 1. 使用 WRK 或 JMeter 压测 `/sites/` 接口。 | 1. 95% 请求响应时间 < 500ms。<br>2. 无 500 错误。 |

### 3.3 智能分析模块 (Insights)

| 用例ID | 测试项 | 前置条件 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-007** | 向量检索准确性 | 向量库已构建 | 1. 输入问题“The Great Wall”。<br>2. 查看后端日志中检索到的 Top-3 文档。 | 1. Top-1 文档必须是“长城”相关的条目。 |
| **TC-008** | RAG 回答生成 | LLM 服务在线 | 1. 提问“哪些遗产在中国？”。 | 1. AI 回答列出若干中国遗产。<br>2. 回答准确无幻觉（基于检索到的上下文）。 |
| **TC-009** | 拒绝回答测试 | - | 1. 提问与遗产无关的问题（如“如何做红烧肉”）。 | 1. AI 应回答“无法根据现有数据回答”或尝试强行关联（取决于 Prompt 设定，建议设为拒答）。 |
